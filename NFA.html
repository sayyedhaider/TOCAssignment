<!DOCTYPE html>
<html lang="en">
  <head>
    <title>NFA</title>
    <meta charset="UTF-8" />
    <!-- <link rel="stylesheet" type="text/css" href="css/rg.css" /> -->
    <link rel="stylesheet" type="text/css" href="css/main.css" />
    <!-- <link rel="stylesheet" type="text/css" href="css/rg.css" /> -->
    <link rel="stylesheet" type="text/css" href="css/util.css" />
  </head>
  <body>
    <div class="container">
      <div class="bigBoxContainer">
        <div class="inputContainer w-50">
          <div class="buttonContainer w-30">
            <button class="normalButton" onclick="validate()">Check</button>
          </div>
          <div class="w-70 f-d-c">
            <a>Check string (input)</a>
            <div class="textAreaContainer">
              <textarea id="test" rows="8" columns="4"></textarea>
              <div class="f-d-c">
                <h2 id="result"></h2>
                <p id="output"></p>
              </div>
            </div>
          </div>
        </div>
        <div class="inputContainer f-d-c w-97">
          <a>NFA (input)</a>
          <br />
          <div class="overflow-a">
            <table id="NFADef" class="verticalTable" onload="loadNFATable()">
              <tr id="AlphabetRow">
                <td>Sum</td>
                <td><input type="text" maxlength="1" size="1" value="a" /></td>
                <td><input type="text" maxlength="1" size="1" value="b" /></td>
                <td><input type="text" maxlength="1" size="1" value="c" /></td>
                <td><input type="text" maxlength="1" size="1" value="d" /></td>
                <td>
                  <button
                    id="test2"
                    class="tableButton"
                    onclick="addCell(this.parentNode.parentNode)"
                  >
                    +
                  </button>
                </td>
              </tr>
              <tr id="StatesRow">
                <td>Q</td>
                <td><input type="text" maxlength="1" size="1" value="R" /></td>
                <td><input type="text" maxlength="1" size="1" value="S" /></td>
                <td><input type="text" maxlength="1" size="1" value="T" /></td>
                <td><input type="text" maxlength="1" size="1" value="U" /></td>
                <td>
                  <button
                    id="test2"
                    class="tableButton"
                    onclick="addCell(this.parentNode.parentNode)"
                  >
                    +
                  </button>
                </td>
              </tr>
              <tr id="StartRow">
                <td>START</td>
                <td><input type="text" maxlength="1" size="1" value="S" /></td>
              </tr>
              <tr id="FinalRow">
                <td>FINAL</td>
                <td><input type="text" maxlength="1" size="1" value="U" /></td>
                <td><input type="text" maxlength="1" size="1" value="" /></td>
                <td><input type="text" maxlength="1" size="1" value="" /></td>
                <td><input type="text" maxlength="1" size="1" value="" /></td>
                <td>
                  <button
                    id="test2"
                    class="tableButton"
                    onclick="addCell(this.parentNode.parentNode)"
                  >
                    +
                  </button>
                </td>
              </tr>
            </table>
          </div>
          <div class="buttonContainer w-20 p-b-20 p-t-20">
            <button class="normalButton" onclick="loadNFATable()">
              Generate NFA Transition Table
            </button>
          </div>
          <div class="overflow-a">
            <table id="NFATable" class="normalTable"></table>
          </div>
          <div class="buttonContainer w-20 p-b-20 p-t-20">
            <button class="normalButton" onclick="saveData()">Save Data</button>
          </div>
          <div class="buttonContainer w-20 p-b-20 p-t-20">
            <button class="normalButton" onclick="">Convert NFA to RG</button>
          </div>
          <div class="textAreaContainer w-50 f-d-c">
            <a>Regular Grammars</a>
            <textarea readonly rows="8" columns="4"></textarea>
          </div>
        </div>
      </div>
    </div>

    <script>
      validate = function () {
        inputText = document
          .getElementById("test")
          .value.replace(/ /g, "")
          .split("\n");
        console.log(inputText);
        let regGramRegex = /^[A-Z] *-> *(?:(?:[a-z]+|[a-z]*[A-Z]) *\| *)*[a-z]*[A-Z]|[a-z]+|Îµ *$/;
        inputText.forEach((elem) => {
          console.log("hi");
          let result = elem.match(regGramRegex);
          document.getElementById("result").innerHTML = "Results: ";
          document.getElementById("output").innerHTML =
            result === null ? "Not valid" : "Valid";
          if (result !== null) {
            parseText(elem);
          }
        });
      };
      var tokens = [];
      parseText = function (text) {
        let temp = [];
        let pos = text.search("->");
        temp.push(text.substring(0, pos));
        text
          .substring(pos + 2)
          .split("|")
          .forEach((elem) => temp.push(elem));
        //console.log(temp);
        tokens.push(temp);
        console.log(tokens);
      };

      addCell = function (row) {
        let length = row.cells.length;
        row.insertCell(length - 2);
        row.cells[row.cells.length - 3].innerHTML =
          "<input type='text' maxlength='1' size='1'>";
      };
      loadNFATable = function () {
        let alphabets = document.getElementById("AlphabetRow");
        let states = document.getElementById("StatesRow");
        let start = document.getElementById("StartRow");
        let final = document.getElementById("FinalRow");
        let table = document.getElementById("NFATable");

        let found = false;
        for (let i = 1; i < states.cells.length - 1; i++) {
          //console.log(start.cells[1].firstElementChild.value);
          //console.log(states.cells[0].innerHTML);

          if (
            start.cells[1].firstElementChild.value ===
            states.cells[i].firstElementChild.value
          )
            found = true;
        }

        if (!found) {
          alert("Invalid start state. Please select a state from Q.");
          return;
        }

        for (let i = 1; i < final.cells.length - 1; i++) {
          if (final.cells[i].firstElementChild.value !== "") {
            let found = false;
            for (let j = 1; j < states.cells.length - 1; j++) {
              console.log(final.cells[i].firstElementChild.value);
              console.log(states.cells[j].firstElementChild.value);

              if (
                final.cells[i].firstElementChild.value ===
                states.cells[j].firstElementChild.value
              ) {
                found = true;
              }
              console.log(found);
            }
            if (!found) {
              alert("Invalid final state. Please select a state from Q.");
              return;
            }
          }
        }

        table.innerHTML = ""; //Reset the table
        table.insertRow(0);
        table.rows[0].insertCell(-1);
        table.rows[0].cells[0].className = "NFATableRow";
        table.rows[0].cells[0].innerHTML = "";
        for (let i = 1; i < alphabets.cells.length - 1; i++) {
          table.rows[0].insertCell(-1);
          table.rows[0].cells[i].className = "NFATableRow";
          table.rows[0].cells[i].innerHTML =
            alphabets.cells[i].firstElementChild.value;
        }

        for (let i = 1; i < states.cells.length - 1; i++) {
          table.insertRow(-1);
          let rowLength = table.rows.length - 1;
          table.rows[rowLength].insertCell(-1);
          table.rows[rowLength].cells[0].className = "NFATableRow";
          table.rows[rowLength].cells[0].innerHTML =
            states.cells[i].firstElementChild.value;

          let prefix = "";
          for (let k = 1; k < start.cells.length; k++) {
            if (
              start.cells[k].firstElementChild.value ===
              table.rows[rowLength].cells[0].innerHTML
            ) {
              prefix += ">";
            }
          }
          for (let k = 1; k < final.cells.length - 1; k++) {
            console.log(final.cells[k].firstElementChild.value);
            console.log(table.rows[rowLength].cells[0].innerHTML);
            if (
              final.cells[k].firstElementChild.value ===
              table.rows[rowLength].cells[0].innerHTML
            ) {
              prefix += "*";
            }
          }

          table.rows[rowLength].cells[0].innerText =
            prefix + table.rows[rowLength].cells[0].innerText;

          for (let j = 1; j < alphabets.cells.length - 1; j++) {
            table.rows[rowLength].insertCell(-1);
            table.rows[rowLength].cells[j].className = "NFATableRow";
            table.rows[rowLength].cells[j].innerHTML =
              "<input type='text' maxlength='1' size='1'>";
          }
        }
      };
    </script>
  </body>
</html>
